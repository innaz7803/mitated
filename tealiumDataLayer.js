!function(e){"use strict";e.require;e.requirejs;var t=e.define;t("kungfu/Tealium/tealiumDataLayer",["require","jquery","lib/Util"],function(e){var t=e("jquery");e("lib/Util");$debug("**** Tealium Universal Data Object Started **** ","mmmTealium");var i=function(){this.udo={};this.date=new Date;this.ua=window.navigator.userAgent;this.userBrowser="";this.$pageMap="";this.browsers=[{name:"Safari",test:this.ua.indexOf("Safari")>-1,version:/AppleWebKit\/([\d\.]+)/},{name:"Android",test:this.ua.indexOf("Android")>-1&&this.ua.indexOf("Mobile Safari")>-1,version:/Android\/([\d\.]+)/},{name:"Chrome",test:this.ua.indexOf("Chrome")>-1,version:/Chrome\/([\d\.]+)/},{name:"Firefox",test:this.ua.indexOf("Firefox")>-1,version:/Firefox\/([\d\.]+)/},{name:"Microsoft Edge",test:this.ua.indexOf("Edge")>-1,version:/rv:([\d\.]+)/},{name:"Internet Explorer",test:this.ua.indexOf("Trident")>-1&&this.ua.indexOf("rv:11"),version:/rv:([\d\.]+)/},{name:"Internet Explorer (legacy)",test:this.ua.indexOf("MSIE")>-1,version:/MSIE ([\d\.]+)/},{name:"Opera",test:this.ua.indexOf("OPR")>-1||this.ua.indexOf("Opera")>-1,version:/Opera\/([\d\.]+)/},{name:"Silk",test:this.ua.indexOf("Silk")>-1,version:/Silk\/([\d\.]+)/}];this.constants={page_name:document.title,event_id:0,event_source:document.location.host+document.location.pathname,visit_date:this.date.getUTCDate()+"-"+parseInt(this.date.getUTCMonth()+1)+"-"+this.date.getUTCFullYear(),visit_time:this.date.getUTCHours()+":"+this.date.getUTCMinutes()+":"+this.date.getUTCSeconds(),browser:this.getBrowser(),browser_version:this.getBrowserVersion(),user_language:this.getLocation().language,country:this.getLocation().country,referring_page:document.referrer,page_scroll_depth:""};this.WTMap={ti:"page_name",dl:"event_id",es:"event_source",oss:"search_phrase",oss_r:"search_results",cg_s:["link_category","content_subgroup"],nv:"element_id",dcsvid:"user_login/user_logout",mc_ev:"ad_event_type",mc_id:"ad_id",cg_n:"page_type",conv:"conversion_name",clip_n:"media_name",clip_t:"media_type","DCSext.locale":"locale",r:"result_count",oss_ds:"dist_agreement_search_term",oss_r_ds:"dist_agreement_num_docs",pn_id:"product_id",pn_sku:"product_sku",tx_i:"invoice_number",tx_t:"order_type",tx_s:["revenue","total_amount"],tx_u:["units_sold","units"],si_cs:"conversion_step",si_n:"scenario_name",si_x:"step_number",tx_cartid:"cart_id",pn_sky:"product_sku",z_posupload:"pos_upload",z_scrdpth:"page_scroll_depth",z_createcam:"create_campaign",z_dldistdoc:"dwnld_agreement_doc",z_dlsppa:"dwnld_specialpricing_agreement",z_dlsppr:"dwnld_specialproduct_report",z_dlcam:"dwnld_campaign_file",z_akam_e:"akamai_timeout"};this.udoMap=["page_name","event_id","event_source","search_phrase","search_results","link_category","content_subgroup","element_id","user_login/user_logout","ad_event_type","ad_id","page_type","conversion_name","media_name","media_type","result_count","dist_agreement_search_term","dist_agreement_num_docs","product_id","product_sku","invoice_number","order_type","revenue","total_amount","units_sold","units","conversion_step","scenario_name","step_number","cart_id","product_sku","pos_upload","page_scroll_depth","create_campaign","dwnld_agreement_doc","dwnld_specialpricing_agreement","dwnld_specialproduct_report","dwnld_campaign_file","akamai_timeout"];this.init()};i.prototype.init=function(){window.utag_data||(this.udo=window.utag_data);this.$pageMap=this.getPageMap();this.initUdo();this.syncWT();this.sync();this.setupHandlers()};i.prototype.setupHandlers=function(){t(window).on("udoReady",function(){$debug("Tealium UDO API loaded and ready...","mmmTealium")});t(window).on("unload",function(){var e=t(window).scrollTop();$debug("Page unloading, capturing scroll depth: "+e,"mmmTealium");window.utag_data.page_scroll_depth=e;$debug("Final UDO before exiting page:","mmmTealium");$debug(utag_data.page_scroll_depth,"mmmTealium")})};i.prototype.getBrowser=function(){var e=this,t="Browser not detected",i=0,a=0;for(i=0,a=this.browsers.length;a>i;i++)if(this.browsers[i].test){$debug("Browser match found: "+this.browsers[i].name,"mmmTealium");t=this.browsers[i].name;e.userBrowser=this.browsers[i]}return t};i.prototype.getBrowserVersion=function(){var e="Browser Version not detected";$debug("Testing for browser version... "+this.userBrowser.version,"mmmTealium");e=this.ua.match(this.userBrowser.version);e&&e[1]&&(e=e[1]);$debug("Browser version number: "+e,"mmmTealium");return e};i.prototype.getLocation=function(){var e={},i=t('meta[name="DCSext.locale"]').attr("content");$debug("Full locale: "+i,"mmmTealium");if(void 0!==i&&""!==i){e.language=i.substring(0,i.indexOf("_"));e.country=i.substring(i.indexOf("_")+1,i.length)}$debug("Language identifier: "+e.language,"mmmTealium");$debug("Country identifier: "+e.country,"mmmTealium");return e};i.prototype.getPageMap=function(){var e="";t.each(t("head").contents(),function(){8===this.nodeType&&this.nodeValue.indexOf("<PageMap>")>-1&&(e=t(this.nodeValue.substring(this.nodeValue.indexOf("<PageMap>"),this.nodeValue.indexOf("</PageMap>")+10)))});return e};i.prototype.initUdo=function(){var e=this;t.each(this.constants,function(t,i){$debug('Loading UDO property: "'+t+'"" with value: "'+i+'"',"mmmTealium");e.udo[t]=i});$debug("Initial properties loaded:","mmmTealium");$debug(this.udo,"mmmTealium");return this};i.prototype.sync=function(e){if(void 0===e){$debug("Synching local UDO with global UDO...","mmmTealium");t.extend(window.utag_data,this.udo)}else{$debug('Synching variable "'+e+'" from local UDO to global UDO...',"mmmTealium");window.utag_data[e]=this.udo[e]}};i.prototype.syncWT=function(){var e,i,a=this;$debug("Synching Tealium WT variables with local UDO...","mmmTealium");$debug("WT object:","mmmTealium");$debug(window.WT,"mmmTealium");t.each(this.WTMap,function(t,n){var o=n;if(n.constructor===Array)for(e=0,i=n.length;i>e;e++){o=n[e];a.syncVal(t,o,"WT.");a.syncVal(t,o);a.syncVal(o,o)}else{a.syncVal(t,o,"WT.");a.syncVal(t,o);a.syncVal(o,o)}});return this};i.prototype.syncUDO=function(){var e=this;$debug("Synching Tealium meta tags with local UDO...","mmmTealium");t.each(this.udoMap,function(t){e.syncVal(e.udoMap[t],e.udoMap[t])});return this};i.prototype.syncVal=function(e,i,a){void 0===a&&(a="");var n=t('meta[name="'+a+e+'"]'),o="";""!==this.$pageMap&&(o=this.$pageMap.find('attribute[name="'+a+e+'"]'));if(void 0!==window.WT[e]){$debug('Found WT variable "'+a+e+'" with value of "'+window.WT[e]+'", adding it to UDO as "'+i+'"',"mmmTealium");this.udo[i]=window.WT[e]}if(n.length>0){$debug('Found WT meta tag "'+a+e+'" with value of "'+n.attr("content")+'", adding it to UDO as "'+i+'"',"mmmTealium");this.udo[i]=n.attr("content")}if(""!==o&&o.length>0){$debug('Found <PageMap> attribute "'+a+e+'" with value of "'+o.text()+'", adding it to UDO as "'+i+'"',"mmmTealium");this.udo[i]=o.text()}};i.prototype.addVar=function(e,t){this.udo=window.utag_data;if(void 0!==e){$debug('Adding new utag variable "'+e+'," with value "'+t+'"',"mmmTealium");this.udo[e]=void 0===t?"":t;this.sync(e)}};i.prototype.removeVar=function(e,t){this.udo=window.utag_data;if(void 0!==e)if(void 0!==t&&t){$debug("Nulling value for utag variable: "+e,"mmmTealium");this.udo[e]="";this.sync(e)}else{$debug("Removing utag variable: "+e,"mmmTealium");delete this.udo[e];delete window.utag_data[e]}};i.prototype.pageView=function(e,i,a){var n={};this.udo=window.utag_data;void 0!==i&&i.constructor==Array&&this.addArray(n,i,"page view");if(void 0!==a&&a.constructor==Object){$debug("Adding custom utag variables to page view event:","mmmTealium");$debug(a,"mmmTealium");t.extend(n,a)}$debug("Firing utag page view event with utag data:","mmmTealium");$debug(n,"mmmTealium");window.utag.view(n)};i.prototype.linkClick=function(e,i,a,n,o){var r={};this.udo=window.utag_data;void 0!==i&&i.constructor==Array&&this.addArray(r,i,"link event");if(void 0!==a&&a.constructor==Object){$debug("Adding custom utag variables to link click event:","mmmTealium");$debug(a);t.extend(r,a)}$debug("Firing utag page view event with utag data:","mmmTealium");$debug(r);window.utag&&window.utag.link?window.utag.link(r,function(){n.trigger(o,{linkFired:!0})}):$debug("error... window.utag not loaded","mmmTealium")};i.prototype.addArray=function(e,t,i){var a,n,o=e;for(a=0,n=t.length;n>a;a++){var r=t[a];if(void 0!==this.udo[r]){$debug("Adding "+i+' variable "'+r+'" with value "'+this.udo[r]+'"',"mmmTealium");o[r]=this.udo[r]}else $debug('UDO variable "'+r+'" does not exist, cannot add to '+i+"...","mmmTealium")}return o};return i})}(MMMRequire);
//# sourceMappingURL=tealiumDataLayer.js.map